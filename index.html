<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>6&quot; Soil Temperature – Holdrege, NE</title>

  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --page: #f7f9fc;
      --card: #ffffff;
      --border: #e6ecf5;
      --shadow: rgba(15, 23, 42, 0.06);
      --text: #0f172a;
      --muted: #5b6b80;

      /* Accent colors */
      --ok: #33d17a;   /* current */
      --hi: #ff5577;   /* high */
      --lo: #4ea3ff;   /* low */
      --avg: #ffbf47;  /* avg/trend */
    }

    *{ box-sizing:border-box }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--page);
      color:var(--text);
      font-family:'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    }

    .card{
      width:min(92vw, 560px);
      background:var(--card);
      border:1px solid var(--border);
      box-shadow:0 8px 24px var(--shadow);
      border-radius:14px;
      padding:24px;
      text-align:center;
    }

    .title{ font-weight:800; font-size:26px; margin:0 0 2px }
    .subtitle{ font-size:16px; font-weight:600; opacity:.9; margin:0 0 2px }
    .location-note{ font-size:13px; color:var(--muted); margin:0 0 16px }

    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:14px }
    .tile{
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px 12px 10px;
      text-align:center;
    }
    .label{ font-size:12px; font-weight:700; color:var(--muted); margin-bottom:4px }
    .val{ font-size:28px; font-weight:900; margin:2px 0 0 }
    .time{ font-size:12px; color:var(--muted); margin-top:4px }

    .current .val{ color:var(--ok) }
    .high .val{ color:var(--hi) }
    .low .val{ color:var(--lo) }
    .avg .val{ color:var(--avg) }

    .section{ margin-top:6px }
    .section h3{
      margin:6px 0 10px;
      font-size:15px;
      font-weight:800;
      color:var(--text);
    }
    .trend-grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
    .trend-tile{
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
    }
    .t-label{ font-size:12px; font-weight:700; color:var(--muted); margin-bottom:6px }
    .t-val{ font-size:24px; font-weight:900; line-height:1.1 }
    .t-up{ color:var(--avg) }
    .t-down{ color:var(--lo) }
  </style>
</head>
<body>
  <div class="card">
    <h1 class="title">6&quot; Soil Temperature</h1>
    <div class="subtitle">Holdrege, NE</div>
    <div class="location-note">Dryland corn stubble</div>

    <div id="content">Loading…</div>
  </div>

  <script>
    (async () => {
      const loggerName = "25x4gcityw";
      const tz = "America/Chicago";
      const bust = Date.now();
      const url = `/.netlify/functions/soil-temp?name=${encodeURIComponent(loggerName)}&tz=${encodeURIComponent(tz)}&days=30&_=${bust}`;

      const toF = c => Math.round((c * 9/5 + 32) * 10) / 10;
      const deltaToF = dc => Math.round((dc * 9/5) * 10) / 10;
      const signed = n => (n > 0 ? `+${n}` : `${n}`);

      try{
        const res = await fetch(url);
        const data = await res.json();

        if (data.error || data.note){
          document.getElementById("content").textContent = data.error || data.note;
          return;
        }

        const trendTile = (label, deltaC) => {
          if (deltaC === null || deltaC === undefined) {
            return `
              <div class="trend-tile">
                <div class="t-label">${label}</div>
                <div class="t-val">—</div>
              </div>`;
          }
          const dF = deltaToF(deltaC);
          const cls = dF >= 0 ? "t-up" : "t-down";
          return `
            <div class="trend-tile">
              <div class="t-label">${label}</div>
              <div class="t-val ${cls}">${signed(dF.toFixed(1))}°</div>
            </div>`;
        };

        document.getElementById("content").innerHTML = `
          <div class="grid">
            <div class="tile current">
              <div class="label">Current</div>
              <div class="val">${toF(data.current.value)}°F</div>
              <div class="time">${data.current.time}</div>
            </div>
            <div class="tile avg">
              <div class="label">Average (today)</div>
              <div class="val">${data.avg !== null ? toF(data.avg) : "—"}°F</div>
              <div class="time">${data.count ?? 0} readings</div>
            </div>
          </div>

          <div class="grid">
            <div class="tile high">
              <div class="label">High</div>
              <div class="val">${data.high ? toF(data.high.value) : "—"}°F</div>
              <div class="time">${data.high ? data.high.time : "—"}</div>
            </div>
            <div class="tile low">
              <div class="label">Low</div>
              <div class="val">${data.low ? toF(data.low.value) : "—"}°F</div>
              <div class="time">${data.low ? data.low.time : "—"}</div>
            </div>
          </div>

          <div class="section">
            <h3>Trends</h3>
            <div class="trend-grid">
              ${trendTile("7-day",  data.trend7d?.delta)}
              ${trendTile("30-day", data.trend30d?.delta)}
            </div>
          </div>
        `;
      } catch (e) {
        document.getElementById("content").textContent = "Fetch error: " + e.message;
      }
    })();
  </script>
</body>
</html>
